# Upgrade $TERM
set -g default-terminal "tmux-256color"
set -as terminal-features ",tmux-256color*:RGB"
# C-a ar prefix
set -g prefix C-a
unbind C-b
bind C-a send-prefix
# prefix R to reload
bind R source-file $XDG_CONFIG_HOME/tmux/tmux.conf
# Count windows and panes from 1
set -g base-index 1
setw -g pane-base-index 1
# Required by neovim for `autoread`
set -g focus-events on
# Increase scrollback size
set -g history-limit 50000
# Increase tmux messages display duration
set -g display-time 4000
# Refresh status more often
set -g status-interval 2
# Vi motion in copy mode
set -wg mode-keys vi
# Yank to clipboard
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi V send -X select-line
bind -T copy-mode-vi y send -X copy-pipe-and-cancel 'clipcopy'
# Focus events enabled for terminals that support them
set -g focus-events on
# Remove wait after ESC is pressed (meta in macos)
set -s escape-time 0
# Enable mouse
set -g mouse on
# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on
# Automatically save status for resurrect
set -g @continuum-restore 'on'
# Resurrect pane contents and nvim sessions
set -g @resurrect-capture-pane-contents 'on'
# set -g @resurrect-strategy-nvim 'session' # handle sessions on nvim first
# Autostart alacritty and tmux on boot
set -g @continuum-boot 'on'
set -g @tpm-install 'u'
if-shell '[[ -f $(which ghostty) ]]' 'set -g @continuum-boot-options "ghostty"'

# Windows
bind a      last-window
bind "c"    new-window -c "#{pane_current_path}"
bind C-p    previous-window
bind C-n    next-window
bind -r "<" swap-window -d -t -1
bind -r ">" swap-window -d -t +1

# Panes
bind n    select-pane -L
bind C-n  select-pane -L
bind e    select-pane -D
bind C-e  select-pane -D
bind i    select-pane -U
bind C-i  select-pane -U
bind o    select-pane -R
bind C-o  select-pane -R
bind -r N resize-pane -L "5"
bind -r E resize-pane -D "5"
bind -r I resize-pane -U "5"
bind -r O resize-pane -R "5"

# Splits
bind "|"  split-window -h -c "#{pane_current_path}"
bind "\\" split-window -fh -c "#{pane_current_path}"
bind "-"  split-window -v -c "#{pane_current_path}"
bind "_"  split-window -fv -c "#{pane_current_path}"
bind "%"  split-window -h -c "#{pane_current_path}"
bind '"'  split-window -v -c "#{pane_current_path}"

# Custom scripts
if-shell '[[ -f $(which ollama) ]]' {
   bind h "split-window 'ollama run $(ollama list | grep : | cut -f1 | fzf)'"
}

# Plugins
# set -g @plugin 'catppuccin/tmux#1.0.0'
# mkdir -p $TMUX_PLUGIN_MANAGER_PATH/catppuccin && git clone -b v2.1.3 https://github.com/catppuccin/tmux.git $TMUX_PLUGIN_MANAGER_PATH/catppuccin/tmux
# Manual install until this issue is fixed:
# https://github.com/catppuccin/tmux/issues/129
run $TMUX_PLUGIN_MANAGER_PATH/catppuccin/tmux/catppuccin.tmux
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum' # leave last so themes do not override it
## Boostrap - install tpm if not already installed
if "test ! -d ${TMUX_PLUGIN_MANAGER_PATH}/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ${TMUX_PLUGIN_MANAGER_PATH}/tpm'"
run "${TMUX_PLUGIN_MANAGER_PATH}/tpm/tpm"
